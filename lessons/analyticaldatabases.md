# Аналитические движки 

---

## 1. Аналитические СУБД как класс

### Инфраструктура данных включает:
- **Operational Data Systems (OLTP)**:
    - Данные, производимые в ходе повседневной деятельности.
    - Поддерживают доступ к операционным транзакциям.
- **Analytical Data Systems (OLAP)**:
    - Данные для принятия бизнес-решений.
    - Лучше всего хранить в системах OLAP.

### OLTP (OnLine Transactional Processing)
- **Цель:** Ввод, редактирование, удаление данных онлайн.
- **Характеристики:**
    - Нормализованные данные.
    - Высокая интенсивность добавления/изменения.
    - Много активных пользователей.
    - Содержат актуальные данные.
    - Используют транзакции с малыми объёмами данных.
    - Трехуровневая архитектура (представление, бизнес-логика, хранилище).

### OLAP (OnLine Analytical Processing)
- **Цель:** Аналитическая обработка данных в реальном времени.
- **Бизнес-смысл:** Принятие подготовленных решений на основе исторических данных.
- **Технические особенности:**
    - Используется для отчётов на больших объёмах данных.
    - Часто столбцовые СУБД.
    - Быстрый выбор данных.
    - Центр — таблица фактов с показателями и ссылками на справочники.
    - Больше денормализация.

---

## 2. Ключевые принципы устройства аналитических СУБД

### MPP (Massive Parallel Processing)
- **Определение:** Массово-параллельная обработка данных.
- **Как работает:** Распределение данных и вычислений между несколькими узлами.
- **Плюсы:** Высокая скорость обработки больших данных, горизонтальное масштабирование, отказоустойчивость.
- **Минусы:** Высокие требования к ресурсам, низкая производительность при множестве простых запросов.

### Shared Nothing Architecture
- Каждый узел независим, имеет свою память и диски.
- Позволяет эффективно масштабироваться.

### Хранение данных по колонкам
- Оптимизировано для аналитических запросов (агрегации, GROUP BY).
- Уменьшает объём чтения с диска.

### Сжатие данных
- **Алгоритмы:** LZ4 (очень быстрый), ZSTD (хороший компромисс скорость/сжатие).
- **Структура блока:** Заголовок с контрольной суммой, размеры, режим сжатия, сжатые данные.

### Представители MPP СУБД:
- Greenplum Database
- ClickHouse
- Vertica

---

## 3. Знакомство с ClickHouse

### История и масштабы
- Разработан в Яндекс, open-source с 2016.
- **Пример масштаба (Yandex.Metrica):**
    - 120 млрд строк в день.
    - 57 трлн строк всего (2020).
    - 66 ПБ несжатых данных → 5.68 ПБ после сжатия.

### Зачем нужен ClickHouse?
- **Производительность:** Очень высокая скорость аналитических запросов.
- **Стоимость:** Опенсорсный, низкая стоимость масштабирования.
- **Операционная стоимость:** Проще в управлении, чем некоторые облачные аналоги (RedShift, BigQuery).

### Сферы применения:
- Веб-аналитика.
- AdTech.
- Анализ логов.
- Финансовый анализ.
- Телекоммуникации.
- Мониторинг производственных процессов.
- Блокчейн-аналитика.

### Примеры интеграций и использования

#### 1. Работа с Object Storage (S3)
```sql
-- Чтение данных напрямую из S3
SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_*.gz', 'TabSeparatedWithNames')
LIMIT 10;

-- Создание таблицы с движком S3
CREATE TABLE s3_engine_table (
    name String,
    value UInt32
) ENGINE = S3(path, [aws_access_key_id, aws_secret_access_key,] format, [compression]);
```

#### 2. Интеграции с другими БД
- Поддерживается подключение к:
    - PostgreSQL (Greenplum)
    - MongoDB
    - MySQL
    - Redis

#### 3. Интеграция с Apache Kafka
- Использование движка Kafka для потоковой загрузки данных.

#### 4. Визуализация данных
- Подключение BI-инструментов (например, Metabase).

---

## 4. Подготовка инфраструктуры и инструменты

### Инструменты разработки:
- **Терминал:** базовые команды (`pwd`, `ls`, `cd`, `mkdir`, `rm`).
- **Git:** основные команды (`status`, `log`, `commit`, `push`, `pull`, `merge`).

### Docker
- **Dockerfile → Docker Image → Docker Container.**
- Используется для создания изолированных сред.

### Yandex Cloud CLI (yc)
- Утилита для управления ресурсами Yandex Cloud.

---

## 5. Список материалов для самостоятельного изучения
1. Shared Nothing Architecture Explained.
2. Сравнение ClickHouse vs. Greenplum.
3. What is an MPP Database? Intro to Massively Parallel Processing.
4. Row vs Column Oriented Databases.
5. Официальная документация ClickHouse: [clickhouse.tech](https://clickhouse.tech/).
6. Блог Altinity: [altinity.com/blog](https://www.altinity.com/blog).

---
