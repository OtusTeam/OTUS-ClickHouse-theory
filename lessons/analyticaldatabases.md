# Аналитические СУБД

Аналитические СУБД (OLAP-системы) предназначены для обработки больших объемов данных в целях бизнес-аналитики. Они отличаются от OLTP-систем фокусом на чтение и агрегацию исторических данных.

## OLTP vs OLAP

OLTP (Online Transaction Processing) поддерживает повседневные операции: ввод, редактирование и удаление данных в реальном времени. Данные нормализованы, транзакции короткие, много пользователей.

OLAP (Online Analytical Processing) анализирует большие объемы для отчетов и решений. Использует денормализованные данные, столбцовое хранение, центр — факт-таблицы с метриками и измерениями.


| Характеристика | OLTP | OLAP |
| :-- | :-- | :-- |
| Цель | Транзакции онлайн | Анализ исторических данных |
| Данные | Нормализованные, актуальные | Денормализованные, исторические |
| Запросы | Много мелких записей/обновлений | Агрегации на больших объемах |
| Архитектура | Трехуровневая (UI, логика, БД) | MPP, Shared Nothing |

## Ключевые принципы

MPP (Massively Parallel Processing) распределяет данные и вычисления по узлам для скорости на больших данных. Плюсы: масштабирование, отказоустойчивость; минусы: ресурсоемкость.

**Shared Nothing**: Каждый узел имеет свою память и диски — полная независимость для горизонтального роста.

**Колонковое хранение**: Оптимизировано для GROUP BY, агрегаций; меньше I/O за счет чтения только нужных колонок.

**Сжатие**: LZ4 (быстрое), ZSTD (компромисс); блоки включают заголовок с метаданными.

Примеры MPP: Greenplum, ClickHouse, Vertica.

## ClickHouse

Разработан Yandex (open-source с 2016). Масштаб Yandex.Metrica: 120 млрд строк/день, 57 трлн строк всего, сжатие 66 ПБ → 5.68 ПБ.

Преимущества: Высокая скорость запросов, низкая стоимость (open-source), простота управления vs облачные аналоги (Redshift, BigQuery).

Сферы: Веб-аналитика, AdTech, логи, финансы, телеком, мониторинг, блокчейн.

### Примеры использования

**S3**:

```sql
SELECT * FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_*.gz', 'TabSeparatedWithNames') LIMIT 10;
```

**Интеграции**: PostgreSQL, MongoDB, MySQL, Redis, Kafka (потоковая загрузка).

**BI**: Metabase и подобные.

## Инфраструктура

- **Терминал**: `pwd`, `ls`, `cd`, `mkdir`, `rm`.
- **Git**: `status`, `log`, `commit`, `push`, `pull`, `merge`.
- **Docker**: Dockerfile → Image → Container (изоляция).
- **Yandex Cloud CLI (yc)**: Управление облаком.


## Материалы

- Shared Nothing Explained.
- ClickHouse vs Greenplum.
- MPP Databases Intro.
- Row vs Column Stores.
- Доки: [clickhouse.tech](https://clickhouse.tech).
- Блог: [altinity.com/blog](https://altinity.com/blog).

