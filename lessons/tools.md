## 1. Источники данных

### 1.1. Специфика аналитической нагрузки
Аналитические системы работают с:
1.  Большими данными (терабайты, петабайты).
2.  Распределенными вычислениями.
3.  ETL-пайплайнами, методами машинного обучения, IoT и пр.
4.  Тенденцией "write once - read many" (однократная запись, многократное чтение).

### 1.2. ETL vs ELT
*   **ETL (Extract, Transform, Load):**
    *   Полагается на заранее заданную структуру OLAP-хранилища "в конце".
    *   Удобнее для комплаенса (соответствия требованиям).
    *   Технология, с которой все давно умеют работать.
*   **ELT (Extract, Load, Transform):**
    *   Гибкий подход.
    *   Быстрый.
    *   Низкие требования к обслуживанию (low maintenance).

### 1.3. Распространенные форматы и источники данных
Формат хранения (сжатие, партиционирование, распределение) имеет решающее значение.

*   **OLTP Базы данных (бэкенд):** MongoDB, PostgreSQL. (Пример: таблицы quotes, orders, device_infos, users, transactions).
*   **Приложения (CRM/ERP, Performance Marketing):**
*   **Коллекторы событий:** Например, данные из Яндекс.Метрики (содержат информацию об анонимных ID, заголовках страниц, user-agent, таймстемпах, событиях и т.д.).
*   **Сторонние API:** HTTP-запросы к внешним сервисам (пример: openexchangerates.org), возвращающие данные в JSON-формате.
*   **Файлы и объектные хранилища:**
*   **Webhooks:**

### 1.4. Характеристики и свойства источников
*   **Примеры источников:** Очереди сообщений (NATS, Kafka, RabbitMQ), Syslog, FTP-сервер, файловая система, база данных, HTTP API.
*   **Свойства источников:**
    *   Активный / пассивный источник
    *   Структурированные / неструктурированные данные
    *   Плоские / вложенные структуры
    *   Бинарный / текстовый формат
    *   Наличие уникальных идентификаторов и временных меток
    *   Append-only (только добавление) / Updateable (обновляемый)
    *   Полная / инкрементальная загрузка
    *   Наличие дубликатов
    *   Возможность получения истории изменений
    *   Параллельная / однопоточная загрузка
    *   Партицирование параллельных потоков

### 1.5. Типы выгрузок данных
*   Единоразовая
*   Полная
*   По инкременту
*   По периоду

### 1.6. Методы выгрузки
**Постановка задачи:** Сервисы активно пишут/читают из операционной БД, но пользователям BI/ML/DS нужны данные для анализа.

*   **Пассивная выгрузка:** (Суть не раскрыта, только заголовок).
*   **Активная выгрузка. CDC (Change Data Capture):**
    Захват изменений данных.
    *   **Плюсы:**
        *   100% захват всех изменений.
        *   Возможность делиться изменениями через ESB (Enterprise Service Bus).
        *   Близко к реальному времени (Near-real time).
        *   Меньше трафика.
        *   Меньше нагрузка на БД (в некоторых случаях).
        *   Отслеживание изменяемости схемы.
    *   **Минусы:**
        *   Требует ESB.
        *   Требует настройки всех систем.
        *   Требует контроля и логов.
        *   Не всегда гарантия exactly-once (обработка каждого сообщения ровно один раз).

*   **SCD (Slowly Changing Dimensions)**
    *   **Type 1:** Перезапись (Update Changes).
    *   **Type 2:** Добавление новой записи для сохранения истории (Keep Historical).
    *   **Type 3:** Сохранение ограниченной истории (Preserve Limited History).

## 2. Data Ingestion Tools (DIT)

### 2.1. Требования к DIT для интеграции с ClickHouse
*   Цена
*   Наличие коннекторов
*   Наличие UI
*   Удобство использования
*   Сложность развертывания
*   Удобство поддержки
*   Наличие алертинга и мониторинга
*   Возможность кастомизации
*   Интеграция с системами контроля версий

### 2.2. Популярные DIT
*   **Общие:** Hevo Data, Apache NiFi, Apache Flume, Apache Kafka, Wavefront, Amazon Kinesis, Talend, Apache Gobblin, StreamSets.
*   **Облачные ELT-решения:** Fivetran, Hevo, Stitch, Matillion, XPlenty, Panoply.
*   **Примеры современных решений:** Airbyte.io, Singer.io, Meltano.com, Apache Airflow, Prefect.

### 2.3. Фокус на Airbyte
*   **Ключевые возможности (Features):**
    *   Создан для расширяемости (Built for extensibility).
    *   Опциональные нормализованные схемы (Optional normalized schemas).
    *   Полноценный планировщик (Full-grade scheduler).
    *   Мониторинг в реальном времени (Real-time monitoring).
    *   Инкрементальные обновления (Incremental updates).
    *   Ручное полное обновление (Manual full refresh).
    *   Автономность отладки (Debugging autonomy).

## 3. Оркестрация

### 3.1. От Cron до современной оркестрации
*   **Cron:**
    *   **Плюсы:** Простота, есть по умолчанию на Mac/Linux.
    *   **Минусы:** Слишком простой, нет UI, нет нормального логирования, нельзя создавать связи между задачами.
*   **Современная оркестрация:**
    *   **Почему это удобно:**
        *   Управление через GUI.
        *   Единый веб-портал для всех процессов и серверов.
        *   Возможность создавать связи между задачами (даже сложные).
        *   Реализация любой логики.
        *   Готовая интеграция с Slack, Telegram и т.д.
        *   Наличие алертов и SLA.

### 3.2. Основные понятия (на примере Apache Airflow)
*   **DAG (Directed Acyclic Graph):**
    *   **Directed (Направленный):** У каждой задачи есть хотя бы одна родительская (предыдущая) или дочерняя (последующая) задача.
    *   **Acyclic (Ациклический):** Задачи не могут ссылаться сами на себя (отсутствие циклов).
    *   **Graph (Граф):** Конечный набор узлов и связей между ними.
*   **Workflow (Рабочий процесс):** Последовательность шагов для выполнения Data Engineering задачи.
*   **Task (Задача):** Одна конкретная задача (скачать файл, загрузить CSV в S3, выполнить SQL-запрос).
*   **Operator (Оператор):** Тип задачи (определяет, что именно делает задача).
*   **Task instance (Экземпляр задачи):** Конкретный запуск задачи в определенный период времени.
*   **DAG run (Запуск DAG):** Конкретное выполнение DAG.

### 3.3. Архитектура Airflow
*   **Web Server:** Отвечает за пользовательский интерфейс.
*   **Metadata DB (База метаданных):** Хранит состояние всех процессов и настроек.
*   **Scheduler (Планировщик):** Служба, отвечающая за планирование запуска DAG и задач.
*   **Worker (Рабочий):** Отдельный процесс, в котором непосредственно выполняются задачи.
*   **Executor (Исполнитель):** Механизм, определяющий, как и где запускаются экземпляры задач.

## 4. Рефлексия и материалы
*   **Список материалов для изучения:**
    *   Инструкция по установке
    *   Документация Airflow
    *   Интерактивная справка по cron
    *   Сравнение Luigi и Airflow
    *   Операторы Airflow
    *   Подробнее о CDC
    *   Airflow vs StreamSets
    *   Crash Course по NiFi
    *   ETL vs ELT
